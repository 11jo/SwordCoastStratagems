

DEFINE_ACTION_FUNCTION test BEGIN

ACTION_IF GAME_IS iwdee BEGIN


    LAF include STR_VAR file=research_iwd_scripts.tph END
    LAF iwd_script_explore END

END ELSE BEGIN

    LAF sort_ids STR_VAR ids=spell END

END

END

DEFINE_ACTION_FUNCTION sort_ids STR_VAR ids="" BEGIN
   ACTION_CLEAR_ARRAY ids_entries
   OUTER_SET max=0
   COPY_EXISTING "%ids%.ids" override
       READ_2DA_ENTRIES_NOW ids_array 2
       FOR (i=0;i<ids_array;i+=1) BEGIN
          READ_2DA_ENTRY_FORMER ids_array i 0 num
          PATCH_IF IS_AN_INT num BEGIN
             SET max= num>max ? num : max
             READ_2DA_ENTRY_FORMER ids_array i 1 val
             PATCH_IF VARIABLE_IS_SET $ids_entries("%num%") BEGIN
                SPRINT temp $ids_entries("%num%")
                SPRINT $ids_entries("%num%") "%temp% %val%"
             END ELSE BEGIN
                SPRINT $ids_entries("%num%") "%val%"
             END
          END
       END
   BUT_ONLY
   COPY ".../stratagems-inline/blank" "override/%ids%.ids"
       INSERT_2DA_ROW 0 2 "IDS V1.0"
       SET rowcount=1
       FOR (num=0;num<max;num+=1) BEGIN
          PATCH_IF VARIABLE_IS_SET $ids_entries("%num%") BEGIN
             SPRINT list $ids_entries("%num%")
             WHILE "%list%" STRING_COMPARE "" BEGIN
                LPF return_first_entry STR_VAR list RET entry list END
                INSERT_2DA_ROW rowcount 2 "%num% %entry%"
                SET rowcount+=1
             END
          END
   END
END
