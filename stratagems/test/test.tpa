INCLUDE "%scsroot%/lib/ai_wrap.tph"

DEFINE_ACTION_FUNCTION test BEGIN

ACTION_IF GAME_IS iwdee BEGIN

   /*
   OUTER_SPRINT temples ""
   COPY_EXISTING_REGEXP ".*\.sto" override
      PATCH_IF INDEX_BUFFER ("%CLERIC_RESURRECTION%") >= 0 BEGIN
         SPRINT temples "%temples% %SOURCE_RES%"
      END
   BUT_ONLY
   MAKE_PATCH
      cure=>"%CLERIC_RESTORATION%"
      cure_price=>750
      at_end=>1
   END
   LAF edit_store STR_VAR store="%temples%" editstring="add_cure=>patch_data" END
   */

   /*
   WITH_TRA "%scsroot%/lang/english/difficulty.tra" BEGIN
      LAF include STR_VAR file="difficulty_controls.tpa" locbase=lib END
      LAF difficulty_ui END
   END
   */

   OUTER_SPRINT component_loc lib
   LAF include STR_VAR file=difficulty_controls.tpa locbase=lib END
   LOAD_TRA "stratagems/lang/english/difficulty.tra"
   LAF difficulty_ui END


END ELSE BEGIN

    MAKE_PATCH
       patch_actor_inline=>"match=>~actor_resource=dw#nabsu~ actor_resource=>tanari01"
    END
    LAF edit_area STR_VAR area=ar6105 edits=patch_data END


END

END



/* IWD hla fragment:

     COPY_EXISTING lunumab.2da override
        REPLACE_TEXTUALLY 99 2

      LAF read_file_into_array STR_VAR file=ui.menu locabs=override RET_ARRAY ui_array=file_contents END
      LAF read_file_into_array STR_VAR file=extra_hla_button.menu RET_ARRAY insert_array=file_contents END
      LAF read_file_into_array STR_VAR file=new_hla_menu.menu RET_ARRAY replace_array=file_contents END
      LAF UI_insert_into_menu STR_VAR ui_array_in=ui_array insert_array menu_name=LEVELUP_PROFICIENCIES RET_ARRAY ui_array=ui_array_out END
      LAF UI_replace_menu STR_VAR ui_array_in=ui_array replace_array menu_name=CHARGEN_HIGH_LEVEL_ABILITIES RET_ARRAY ui_array=ui_array_out END
      LAF write_array_into_file STR_VAR file="override/ui.menu" file_contents=ui_array END

      COPY_EXISTING "ui.menu" override
         REPLACE_TEXTUALLY "return +63817" "return 34713"
*/






///////////////////////////////////////////////////////////////////////////////
///     Read in every entry in spell.ids and set a variable with that name whose
///     value is the spell resref, and store the data in the sfo_spell_resrefs array
///
///     e.g. WIZARD_FIREBALL = SPWI304
///          $sfo_spell_resrefs("WIZARD_FIREBALL") = SPWI304
///
///    If sfo_include_scrolls is set to 1, also reads in every divine and arcane
///    spell, and stores them like this:
///
///    WIZARD_FIREBALL_SCROLL=scrl1g
///    $sfo_arcane_scrolls("WIZARD_FIREBALL")=scrl1g
///    CLERIC_FREE_ACTION_SCROLL=scrl58
///    $sfo_divine_scrolls("CLERIC_FREE_ACTION")=scrl58
///////////////////////////////////////////////////////////////////////////////

DEFINE_ACTION_FUNCTION read_in_2da
   INT_VAR lookup_column=0
           data_column=1
           first_row=0
   STR_VAR file=""
   RET_ARRAY array_data
BEGIN
   COPY_EXISTING "%file%.2da" "%workspace%"
        COUNT_2DA_COLS colcount
        READ_2DA_ENTRIES_NOW 2da_data colcount
        FOR (i=first_row;i<2da_data;i+=1) BEGIN
           READ_2DA_ENTRY_FORMER 2da_data i lookup_column var
           READ_2DA_ENTRY_FORMER 2da_data i data_column val
           SPRINT $array_data("%var%") "%val%"
        END
        PATCH_IF first_row>=2da_data BEGIN
           SPRINT $array_data("null") ""
        END
   BUT_ONLY
END



