INCLUDE "%MOD_FOLDER%/lib/ai_wrap.tph"

DEFINE_ACTION_FUNCTION test BEGIN

		COPY_EXISTING "dw#sumfi.spl" "override/dw#sumf2.spl"
		COPY_EXISTING "dw#sumfi.spl" "override/dw#sumf3.spl"
		LAF array_read STR_VAR file=trigger_list.2da path="%data_loc%" RET_ARRAY trigger_array=array END
		ACTION_PHP_EACH trigger_array AS contents=>resref BEGIN
			ACTION_IF INDEX ("X_SUMMON_FIEND" "%contents%")>=0 BEGIN
				COPY_EXISTING "%resref%.spl" override
					fiend_count=0
					GET_OFFSET_ARRAY ab_arr SPL_V10_HEADERS
					PHP_EACH ab_arr AS ab_ind=>ab_off BEGIN
						GET_OFFSET_ARRAY2 fx_arr ab_off SPL_V10_HEAD_EFFECTS
						PHP_EACH fx_arr AS fx_ind=>fx_off BEGIN
							PATCH_IF SHORT_AT fx_off=146 BEGIN
								READ_ASCII fx_off+0x14 resource
								PATCH_MATCH "%resource%" WITH
								"%WIZARD_SUMMON_FIEND%" "%WIZARD_SUMMON_FIEND_SCS%" BEGIN
									++fiend_count
									PATCH_IF fiend_count>1 BEGIN
										WRITE_ASCII fx_off+0x14 "dw#sumf%fiend_count%" (8)
									END
								END
								DEFAULT
								END
							END
						END
					END
			END
		END


	COPY_EXISTING "dw#lich1.cre" override
		LPF enforce_charclass END

END
<<<<<<<<.../stratagems-inline/include.tph
%data%
>>>>>>>>
