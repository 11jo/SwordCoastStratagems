INCLUDE "%MOD_FOLDER%/lib/ai_wrap.tph"

DEFINE_ACTION_FUNCTION test BEGIN

	OUTER_SPRINT component_loc priest
	LAF include STR_VAR file=priest.tpa locbase=priest END
    // get a list of priests and append to the innocent list (this is hardcoded, on speed grounds)
	OUTER_SPRINT list ""
    COPY_EXISTING_REGEXP GLOB ~drow07.*\.cre~ ~override~
	 PATCH_TRY
        READ_BYTE 0x273 class
        PATCH_MATCH class WITH
        3 // cleric
        15 // cleric_thief
        11 // druid
        8 // fighter_cleric
        16 // fighter_druid
        156 // flaming fist
        BEGIN
             SPRINT filename ~%SOURCE_RES%~
             LPF CRE_is_PC RET is_pc=value END
             LPF CRE_is_dead RET is_dead=value END
             LPF skipped_priest RET is_skipped=value END
             PATCH_IF (!is_dead && !is_pc && !is_skipped) BEGIN
                PUSH list ~%filename%~
             END

        END
        DEFAULT END
	 WITH DEFAULT
			LPF regexp_warning STR_VAR parent=priest_edits_main END
	 END
    BUT_ONLY	
	
	LAF edit_creature STR_VAR creature= ~%list%~ editstring= ~priest_edits_main_patch=>"spells_are_not_bg1"~ END
END

<<<<<<<<.../stratagems-inline/include.tph
%data%
>>>>>>>>
