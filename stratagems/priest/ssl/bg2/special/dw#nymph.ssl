//////////////////////////////////////////////////////////////////////////////////
///
///   Define actions
///
////////////////////////////////////////////////////////////////////////////////////////

VARIABLE(SPELLFAILUREMAGE=SPELLFAILUREPRIEST)
VARIABLE(scsspellsubstitute1=!StateCheck(scstarget,STATE_NOT_TARGETABLE))
VARIABLE(scsspellsubstitute2=!StateCheck(scstarget,STATE_INVISIBLE))
INCLUDE FILE(%scsroot%/mage/ssl/mage_definitions.ssl)


VARIABLE(HasL1=True)
VARIABLE(HasL2=True)
VARIABLE(HasL3=True)
VARIABLE(HasL4=True)
VARIABLE(IsNymph=True)

////////////////////////////////////////////////////////////////////////////////
///	Pre-buff
//////////////////////////////////////////////////////////////////////////////////

IF
	HaveSpell(CLERIC_BARKSKIN)
THEN
	RESPONSE #100
		RemoveSpell(CLERIC_BARKSKIN)
		ApplySpell(Myself,CLERIC_BARKSKIN)
		Continue()
END

///////////////////////////////////////////////////////////////////////////
//	Melee
///////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/priest/ssl/bg2/meleeblocks/standard_priest.ssl)

//////////////////////////////////////////////////////////////////////////
// Renew and retreat
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER(!GlobalTimerNotExpired("castspell","LOCALS"))

IF TRIGGER
	TargetBlock(HumanoidVillains)
	HPPercentLT(scstarget,60)
	Allegiance(scstarget,ENEMY)
	Allegiance(Myself,ENEMY)
THEN DO
	Action(Spell,CLERIC_MASS_CURE)
END



//////////////////////////////////////////////////////////////////////////
// Look for PCs
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER()

INCLUDE FILE(%scsroot%/priest/ssl/bg2/generalblocks/mill.ssl)
INCLUDE FILE(%scsroot%/priest/ssl/bg2/generalblocks/chase.ssl)

////////////////////////////////////////////////////////////////////////////
// Core magic block
///////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%scsroot%/priest/ssl/bg2/priesttypes/nymph.ssl)

//////////////////////////////////////////////////////
///	If everyone is helpless, kill'em.
//////////////////////////////////////////////////////
	
IF
	See(NearestEnemyOf(Myself))
	BEGIN LOOP(scsloopvar||1;2;3;4;5;6)
		OR(3)
			!See(Playerscsloopvar)
			StateCheck(Playerscsloopvar,STATE_IMMOBILE)
			CheckStatGT(Playerscsloopvar,0,HELD)
	END LOOP
THEN
	RESPONSE #100
		AttackReevaluate(NearestEnemyOf(Myself),15)
END

INCLUDE FILE (%scsroot%/priest/ssl/bg2/generalblocks/closedown.ssl)


