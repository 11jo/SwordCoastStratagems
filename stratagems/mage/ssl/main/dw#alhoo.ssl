//////////////////////////////////////////////////////////////////////////////////
///
///   Define actions
///
////////////////////////////////////////////////////////////////////////////////////////

BEGIN LOOP(!StateCheck\(scstarget,STATE_NOT_TARGETABLE\)|| )
BEGIN LOOP(!StateCheck\(scstarget,STATE_INVISIBLE\) || )
	INCLUDE FILE(%MOD_FOLDER%/caster_shared/caster_definitions.ssl)
END LOOP
END LOOP
VARIABLE(IsAlhoon=True)

////////////////////////////////////////////////////////////////
/// Labelling, break-invisibility, hostile-undead, panic, etc
////////////////////////////////////////////////////////////////////////////////////////


INCLUDE FILE(%MOD_FOLDER%/mage/ssl/main/preamble.ssl)

//////////////////////////////////////////////////////////////////////////////////
////	Setup, prep
//////////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%MOD_FOLDER%/mage/ssl/main/magesetup.ssl)



//////////////////////////////////////////////////////////////////////////////////
////	If non-hostile, closedown - this script doesn't pretend to fight bad guys
//////////////////////////////////////////////////////////////////////////////////

IF
	!Allegiance(Myself,ENEMY)
	IgnoreBlock(IsPartyAlly)
THEN
	RESPONSE #100
		NoAction()
END


//////////////////////////////////////////////////////////////////////
///CPU saver
//////////////////////////////////////////////////////////////////////

IF
	!Detect(NearestEnemyOf(Myself))
	!HPPercentLT(Myself,100)
	!Global("inafight","LOCALS",1)
THEN
	RESPONSE #100
		NoAction()
END
////////////////////////////////////////////////////////////////////////////
///	Contingencies renew defences
////////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%MOD_FOLDER%/mage/ssl/generalblocks/contingency.ssl)


///////////////////////////////////////////////////////////////////////////
////	Flee Cloudkill spell
///////////////////////////////////////////////////////////////////////////

INCLUDE FILE(%MOD_FOLDER%/mage/ssl/generalblocks/fleecloud_fm.ssl)


///////////////////////////////////////////////////////////////////////////
//	Melee
///////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER(GlobalTimerNotExpired("castspell","LOCALS")GlobalTimerNotExpired("psionics","LOCALS"))

INCLUDE FILE(%MOD_FOLDER%/psionic/ssl/illithid/mfcombat.ssl)

DEFAULT TRIGGER()

//////////////////////////////////////////////////////////////////////////
// Renew and retreat
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER()

INCLUDE FILE(%MOD_FOLDER%/mage/ssl/generalblocks/renew.ssl)

////////////////////////////////////////////////////////////////////////////
///	Report on the Split Mind power; whine.
/////////////////////////////////////////////////////////////////////////////

IF
	!Global("whined","LOCALS",1)
	AreaCheck("AR0711")
	OR(7)
		Detect(NearestEnemyOf(Myself))
		BEGIN LOOP(scsplayer||1;2;3;4;5;6)
			Range(Playerscsplayer,15)
		END LOOP
THEN
	RESPONSE #100
		SetGlobal("whined","LOCALS",1)
		DisplayStringHead(Myself,2138)
		Continue()
END

IF
	!GlobalTimerNotExpired("saidsplitmind","LOCALS")
	See(NearestEnemyOf(Myself))
THEN
	RESPONSE #100
		SetGlobalTimer("saidsplitmind","LOCALS",1000)
		DisplayStringHead(Myself,@302)
		Continue()
END

//////////////////////////////////////////////////////////////////////////
// Easiest-level block
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER()
INCLUDE FILE(%MOD_FOLDER%/mage/ssl/generalblocks/easy.ssl)



//////////////////////////////////////////////////////////////////////////
// Look for PCs
//////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER(!GlobalTimerNotExpired("castspell","LOCALS"))
INCLUDE FILE(%MOD_FOLDER%/mage/ssl/generalblocks/chase.ssl)

////////////////////////////////////////////////////////////////////////////
// Core magic block
///////////////////////////////////////////////////////////////////////////

DEFAULT TRIGGER()
INCLUDE FILE(%MOD_FOLDER%/mage/ssl/magetypes/ssl_mage_type.ssl)

////////////////////////////////////////////////////////////////////////////
// Psionic block
///////////////////////////////////////////////////////////////////////////

BEGIN LOOP(castspell||psionics)
INCLUDE FILE(%MOD_FOLDER%/lib/ssl/shared_definitions.ssl)
END LOOP

INCLUDE FILE(%MOD_FOLDER%/psionic/ssl/illithid/illithidcore.ssl)


////////////////////////////////////////////////////////////////////////////
// Deactivate alacrity instruction for fast casting if relevant
///////////////////////////////////////////////////////////////////////////

IF
	SSLBoolean(WIZARD_IMPROVED_ALACRITY|WIZARD_WISH)
        ActionListEmpty()
	CheckStatGT(Myself,0,WIZARD_IMPROVED_ALACRITY)
	!Global("alacritycompromise","LOCALS",1)
THEN
	RESPONSE #100
		SetGlobal("alacritycompromise","LOCALS",1)
END

DEFAULT TRIGGER()

////////////////////////////////////////////////////////////////////////////
// Closedown
///////////////////////////////////////////////////////////////////////////


INCLUDE FILE(%MOD_FOLDER%/mage/ssl/generalblocks/closedown.ssl)
